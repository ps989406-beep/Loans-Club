<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Loan Club â€” Fast Personal Loans</title>

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css" />
  <meta name="description" content="Loan Club â€” fast and friendly loans. Apply online in minutes and track your status." />
</head>
<body>
  <header class="header header-elevated">
    <div class="container header-inner">
      <div class="brand">
        <div class="logo">LC</div>
        <div class="brand-text">
          <div class="brand-name">Loan Club</div>
          <div class="brand-tag">Fast â€¢ Clear â€¢ Trustworthy</div>
        </div>
      </div>

      <nav class="nav">
        <a class="nav-link" href="#how">How it works</a>
        <a class="nav-link" href="#apply">Apply</a>
        <a class="btn btn-ghost" href="/admin.html" title="Admin (do not share)">Admin</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- HERO -->
    <section class="hero card hero-compact">
      <div class="hero-left">
        <h1>Quick loans with clear terms</h1>
        <p class="lead">Apply online in minutes. Transparent pricing, rapid review â€” funds shown in your dashboard if approved.</p>
        <div class="hero-ctas">
          <button id="ctaApply" class="btn btn-primary">Apply Now</button>
          <button id="ctaCalculator" class="btn btn-outline">Loan Calculator</button>
        </div>

        <ul class="trust-list">
          <li>âœ… Soft credit check</li>
          <li>ðŸ”’ Data encrypted</li>
          <li>ðŸ’¬ Support 9amâ€“6pm</li>
        </ul>
      </div>

      <div class="hero-right">
        <div class="card small-card calc-preview">
          <div class="muted">Estimate monthly</div>
          <div id="calcPreview" class="calc-amount">$0 / month</div>
          <div class="muted small">Use our calculator before applying</div>
        </div>
        <div class="card small-card stats">
          <div class="stat"><div class="stat-num">98%</div><div class="stat-label">Demo Approvals</div></div>
          <div class="stat"><div class="stat-num">~10 min</div><div class="stat-label">Apply time</div></div>
        </div>
      </div>
    </section>

    <!-- HOW IT WORKS -->
    <section id="how" class="card">
      <h2>How Loan Club works</h2>
      <div class="steps">
        <div class="step"><div class="step-num">1</div><div><strong>Apply online</strong><div class="muted">Fill a short form â€” takes minutes.</div></div></div>
        <div class="step"><div class="step-num">2</div><div><strong>We review</strong><div class="muted">Admin reviews and decides quickly.</div></div></div>
        <div class="step"><div class="step-num">3</div><div><strong>Get funds</strong><div class="muted">If approved, amount shows in your dashboard.</div></div></div>
      </div>
    </section>

    <!-- APPLY -->
    <section id="apply" class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>Start your application</h2>
        <div class="muted small">Only a few fields to begin</div>
      </div>

      <form id="loanForm" class="form-grid" autocomplete="off">
        <!-- Step 1: Basic -->
        <div class="form-step">
          <label>Full name <input id="fullName" type="text" placeholder="John Doe" required /></label>
          <label>Email <input id="email" type="email" placeholder="you@example.com" required /></label>
          <label>Phone <input id="phone" type="tel" placeholder="+1 555 444 3333" /></label>
        </div>

        <!-- Step 2: Loan -->
        <div class="form-step">
          <label>Loan amount (USD) <input id="amount" type="number" min="100" step="50" placeholder="5000" required /></label>
          <label>Term (months) <input id="term" type="number" min="1" max="60" placeholder="12" required /></label>
          <label>Purpose <input id="purpose" type="text" placeholder="Home repairs, business, etc." /></label>
        </div>

        <!-- Step 3: Income -->
        <div class="form-step">
          <label>Annual income (USD) <input id="income" type="number" min="0" placeholder="45000" /></label>
          <label>Employer <input id="employer" type="text" placeholder="Company name (optional)" /></label>
        </div>

        <div class="form-actions">
          <div class="muted small" id="formHint">Weâ€™ll only use this to evaluate your application.</div>
          <div class="row">
            <button type="button" id="btnCalculate" class="btn btn-outline">Estimate</button>
            <button type="submit" class="btn btn-primary">Submit Application</button>
          </div>
        </div>
      </form>
    </section>

    <!-- APPLICATION STATUS LIST (customer) -->
    <section id="myApplications" class="card">
      <h3>Your applications</h3>
      <div id="applicationsList" class="list">
        <div class="muted">Login or signup to view applications (demo behavior).</div>
      </div>
    </section>

  </main>

  <!-- toast -->
  <div id="toast" class="toast hidden"></div>

  <script>
  // Inline JS â€” keeps repo small. This is the user-facing UI behavior.
  (function() {
    const API = { load: '/api/load', submit: '/api/submit' };
    let DB = null;
    let currentUser = null; // demo local signup

    /* helpers */
    const byId = id => document.getElementById(id);
    const toast = msg => {
      const t = byId('toast');
      t.textContent = msg;
      t.classList.remove('hidden');
      t.classList.add('show');
      setTimeout(()=> { t.classList.remove('show'); setTimeout(()=> t.classList.add('hidden'), 300); }, 3000);
    };
    const uid = (p='u') => p + '-' + Math.random().toString(36).slice(2,9);

    /* load DB */
    async function loadDB() {
      try {
        const res = await fetch(API.load);
        if (!res.ok) throw new Error('Load failed');
        DB = await res.json();
        renderApplications();
      } catch (err) {
        DB = { users: [{ id:'admin-1', email:'admin@loanclub.local', name:'Admin', role:'admin', password:'Admin@123'}], applications: [] };
        console.warn('Using local demo DB', err);
      }
    }

    /* calculate monthly (simple interest flat for demo) */
    function estimateMonthly(amount, term, rate=0.12) {
      // approximate monthly payment with fixed interest (annuity formula)
      if(!amount || !term) return 0;
      const monthlyRate = rate / 12;
      const n = term;
      const p = amount * (monthlyRate / (1 - Math.pow(1 + monthlyRate, -n)));
      return Math.round(p);
    }

    /* recalc preview */
    function updateCalculatorPreview() {
      const amt = Number(byId('amount').value) || 0;
      const term = Number(byId('term').value) || 12;
      const monthly = estimateMonthly(amt, term);
      byId('calcPreview').textContent = monthly ? ('$' + monthly + ' / month') : '$0 / month';
    }

    /* render applications (simple view for signed-in demo user) */
    function renderApplications() {
      const el = byId('applicationsList');
      el.innerHTML = '';
      if (!DB || !DB.applications || DB.applications.length === 0) {
        el.innerHTML = '<div class="muted">No applications yet â€” submit above to start.</div>';
        return;
      }
      // show latest first
      DB.applications.slice().reverse().forEach(a => {
        const card = document.createElement('div');
        card.className = 'app-card';
        const statusCls = a.status === 'approved' ? 'status-approved' : a.status === 'rejected' ? 'status-rejected' : a.status === 'hold' ? 'status-hold' : 'status-pending';
        card.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="app-title">$${a.requested} â€” ${a.purpose || 'â€”'}</div>
              <div class="muted small">Submitted ${new Date(a.createdAt).toLocaleString()}</div>
            </div>
            <div style="text-align:right">
              <div class="status-badge ${statusCls}">${a.status}</div>
              <div class="muted small">${a.adminComment ? a.adminComment : ''}</div>
            </div>
          </div>
        `;
        el.appendChild(card);
      });
    }

    /* submit application to server (append-only) */
    async function submitApplication(obj) {
      try {
        const res = await fetch(API.submit, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ application: obj })
        });
        if (!res.ok) {
          const txt = await res.text(); throw new Error(txt || 'submit failed');
        }
        DB = await res.json();
        renderApplications();
        toast('Application submitted â€” we will review it shortly.');
      } catch (err) {
        console.error(err);
        toast('Submit failed. Check console/logs.');
      }
    }

    /* form handling with lightweight validation */
    function setupForm() {
      const form = byId('loanForm');
      form.addEventListener('input', updateCalculatorPreview);
      byId('btnCalculate').addEventListener('click', () => {
        updateCalculatorPreview();
        toast('Estimated monthly updated.');
      });

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        // simple validation
        const name = byId('fullName').value.trim();
        const email = byId('email').value.trim();
        const amount = Number(byId('amount').value);
        const term = Number(byId('term').value);
        if (!name || !email || !amount || !term) {
          toast('Please fill required fields: name, email, amount, term.');
          return;
        }
        // create demo user if not exists
        let user = DB.users && DB.users.find(u => u.email === email);
        if (!user) {
          user = { id: uid('u'), email, name, role: 'user', password: 'demo' };
          // for safety in this demo we add locally; admin may import to persist
          DB.users = DB.users || [];
          DB.users.push(user);
        }
        const app = {
          id: uid('app'),
          userId: user.id,
          userName: user.name,
          requested: amount,
          term,
          purpose: byId('purpose').value.trim(),
          income: Number(byId('income').value) || 0,
          createdAt: new Date().toISOString(),
          status: 'pending'
        };
        // submit to server
        submitApplication(app);
        form.reset();
        updateCalculatorPreview();
      });
    }

    /* wire CTA */
    byId('ctaApply').addEventListener('click', () => {
      document.querySelector('#auth')?.scrollIntoView({behavior:'smooth'});
      document.getElementById('auth')?.classList.remove('hidden');
    });
    byId('ctaCalculator').addEventListener('click', () => {
      const amt = Number(prompt('Loan amount (USD)', '5000'));
      const term = Number(prompt('Term in months', '12'));
      if (!amt || !term) return;
      const monthly = estimateMonthly(amt, term);
      alert(`Estimated monthly payment: $${monthly} / month (demo estimate)`);
    });

    /* init */
    (async function init() {
      await loadDB();
      setupForm();
      updateCalculatorPreview();
    })();
  })();
  </script>
</body>
</html>
